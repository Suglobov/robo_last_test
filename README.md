# Описание
Полный текст тестового задания находится в конце этого файла  
Программа позволяет производить отложенный перевод средств между пользователями  
 # Используюемые технологии
php 7.1  
composer  
laravel 5  
mysql  
планировщик задач  

 # Шаги установки
 ## Нужно для работы
 + docker
 + docker-compose
 + планировщик задач
### Опционально
 + make
 + git

1. Клонирование репозитория git
    ```
    git clone https://github.com/Suglobov/robo_last_test.git
    ```

1. Копируем файл ***.env.example*** в файл ***.env***
    Команда для линуска из папки проекта
   ```
   cp .env.example .env
   ```

1. Открыть доступ к папке проекта (777)
Команда для линуска из папки проекта
    ```
    sudo chmod -R 777 .
    ```

1. Выполните команду в папке с проектом
    ```
    make setup
    ```
    Если ***make*** не установлен, то список команд можно взять из ***Makefile***

1. Npm.  
    ***npm install*** отрабатывает в ***docker*** во время исполнения ***make setup***  
    но для работы ***npm run dev*** надо локально ***nodejs*** иметь  
    и использовать ***npm i*** в папке проекта

1. Миграции и сиды.  
    Из папки с проекторм
    ```
    docker-compose exec app php artisan migrate --seed
    ```
    Для пересборки
    ```
    docker-compose exec app php artisan migrate:refresh --seed
    ```
    Сиды отдельно
    ```
    docker-compose exec app php artisan db:seed
    ```

1. На сервере запустите планировщик задач  
    который будет запускать средствами ***docker-compose exec app php*** скрипт ***artisan***  
    по расписанию раз в час  
    
    Пример в linux:
    ```
    * * * * * docker-compose -f /path/to/work/folder/docker-compose.yml exec app php artisan schedule:run >>/dev/null 2>&1
    ```

1. Сайт доступен на <a href="http://localhost:8080/" target="_blank">http://localhost:8080/</a>

1. phpmyadmin доступен по адресу <a href="http://localhost:8081/" target="_blank">http://localhost:8081/</a>

# Текст задания
Задача
Используя любой PHP-фреймворк создать приложение, которое имеет следующие возможности: любой пользователь приложения может выбрать любого другого пользователя приложения (кроме себя), чтобы сделать отложенный перевод денежных средств со своего счета на счет выбранного пользователя. При планировании такого перевода пользователь указывает сумму перевода в рублях, дату и время, когда нужно произвести перевод. Сумма перевода ограничена балансом клиента на момент планирования перевода с учетом ранее запланированных и невыполненных его исходящих переводов. Дата и время выбирается с точностью до часа с использованием календаря. Способ выбора пользователя - любой (можно просто ввод ID). Ввод данных должен валидироваться как на стороне клиента, так и на стороне сервера с выводом ошибок пользователю.
Показать на сайте список всех пользователей и информацию об их одном последнем переводе с помощью одного SQL-запроса к БД.
Реализовать сам процесс выполнения запланированных переводов. Не допустить ситуации, при которой у какого-либо пользователя окажется отрицательный баланс.
Написанный для решения задачи код не должен содержать уязвимостей. Процесс регистрации и проверки прав доступа можно не реализовывать. Для этого допустимо добавить дополнительное поле ввода для указания текущего пользователя. Внешний вид страниц значения не имеет.
Решение задачи должно содержать:
Весь текст поставленного тестового задания. 
Четкую инструкцию по развертыванию проекта с целью проверки его работоспособности. Приветствуется использование Docker. 
Миграции и сиды для наполнения БД демонстрационными данными.
Решение можно прислать ссылкой на хранилище исходного кода (GitHub, Bitbucket и др.), либо в виде архива.

# первый вариант задания
Уважаемый кандидат, мы рады, что вы проявили интерес к компании РобоФинанс! Предлагаем выполнить тестовое задание. Успехов!
Задача:
Используя любой PHP-фреймворк создать приложение, которое имеет следующие возможности: любой пользователь приложения может выбрать любого другого пользователя приложения (кроме себя), чтобы сделать отложенный перевод денежных средств со своего счета на счет выбранного пользователя. При планировании такого перевода пользователь указывает сумму перевода в рублях, дату и время, когда нужно произвести перевод. Сумма перевода ограничена балансом клиента на момент планирования перевода с учетом ранее запланированных и невыполненных его исходящих переводов. Дата и время выбирается с точностью до часа с использованием календаря. Способ выбора пользователя - любой (можно просто ввод ID). Ввод данных должен валидироваться как на стороне клиента, так и на стороне сервера с выводом ошибок пользователю.
Показать на сайте список всех пользователей и информацию об их одном последнем переводе с помощью одного SQL-запроса к БД.
Реализовать сам процесс выполнения запланированных переводов. Не допустить ситуации, при которой у какого-либо пользователя окажется отрицательный баланс.
Написанный для решения задачи код не должен содержать уязвимостей. Процесс регистрации и проверки прав доступа можно не реализовывать. Для этого допустимо добавить дополнительное поле ввода для указания текущего пользователя. Внешний вид страниц значения не имеет.
Решение задачи должно содержать:
1. Весь текст поставленного тестового задания. 2. Четкую инструкцию по развертыванию проекта с целью проверки его
работоспособности. Приветствуется использование Docker. 3. Миграции и сиды для наполнения БД демонстрационными данными.
Решение можно прислать ссылкой на хранилище исходного кода (GitHub, Bitbucket и др.), либо в виде архива.
Памятка по проверке тестового задания
## О задаче
Выполнение задания без использования усложнения при наличии опыта работы со всеми упомянутыми частями приложения может занять до 10 часов. Начинающим программистам может потребоваться в разы больше времени на знакомство с подходами.
Выполнение тестового задания показывает умения:
1. Писать документацию 2. Работать с денежными суммами 3. Использовать транзакции и блокировки 4. Писать приложения для запуска из командной строки по расписанию 5. Делать валидацию на клиентской и серверной частях 6. Писать код без уязвимостей 7. Писать SQL-запросы 8. Писать тесты 9. Оформлять проект для работы в команде
## Варианты усложнения или вопросы к собеседованию для устного обсуждения:
1. Сумма отложенного перевода должна быть кратной 50 копейкам, а баланс клиента
может быть не кратным 50 копейкам. Сложность: низкая. Объём: небольшой. 2. Система взимает комиссию за каждый перевод в размере 0,3%, списывается со счета того, кто переводит. Округление с отбрасыванием знаков после копеек. Сложность: средняя. Объём: средний. 3. Показать уведомление на сайте пользователю, который получил перевод и зашел на
сайт. Сложность: низкая. Объём: большой. 4. Не хранить баланс как одно поле, а считать как сумму зачислений и списаний.
Сложность: высокая. Объём: средний. 5. Реализовать взаимодействие клиентской части с серверной через REST API.
Сложность: средняя. Объём: большой. 6. Реализовать возможность планирование перевода через командную строку на сервере.
Сложность: низкая. Объём: средний. 7. Реализовать планирование переводов для пользователя с помощью загрузки
CSV-файла, содержащим 3 поля: ID пользователя-адресата, сумма перевода, дата и время перевода. Сложность: высокая. Объём: большой. 8. Реализовать выгрузку в формате CSV всех произведенных переводов за выбираемый
интервал времени. Сложность: средняя. Объём: средний. 9. Реализовать интеграцию с любым сервисом отправки SMS. Раз в сутки отправлять SMS
на один заранее предустановленный номер с сообщением о количестве и сумме успешно совершенных переводов. Бесплатные смс для программистов есть, например, у sms.ru. Сложность: высокая. Объём: большой.
## Оценка решения
Задание признается проваленным, если решения нет, либо получено решение, которое непонятно, как проверять, даже после общения с кандидатом.
Во всех остальных случаях решение может быть признано как успешное по усмотрению проверяющего, даже если приложение не разворачивается по инструкции или не проходят написанные тесты, но при этом есть что-то, что все это оправдывает.
### На что обратить внимание при проверке:
1. Инструкция по развертыванию четкая, содержит список зависимостей, команды,
которые необходимо выполнить для получения работающего окружения. Инструкция содержит описание, как запустить тесты. 2. Нет лишних файлов. Например, если использован composer, то директория vendor не
включена в проект, а в инструкции по развертке есть `composer install`. 3. Написаны миграции и сиды или хотя бы есть SQL-файл с демонстрационным
наполнением. 4. Тесты написаны и работают. При этом проверяют хотя бы допустимость перевода. 5. Есть валидация на стороне клиента и на стороне сервера с выводом ошибок
пользователю. При этом проверяется: 4.1. Выбранный пользователь существует (только сервер) 4.2. Введенная сумма является положительной суммой в рублях с копейками 4.3. Введенная сумма доступна пользователю (только сервер) 4.4. Выбранная дата и время валидны и больше текущей 6. Процесс выполнения запланированных переводов происходит по расписанию вызовом
приложения из командной строки. 7. Код написан так, что исключается ситуация, при которой у пользователя может
оказаться отрицательный баланс после совершения перевода. Например, используются блокировки на уровне СУБД. Есть валидация на сервере, исключает ситуацию, что можно с двух вкладок запланировать два перевода, которые приведут к отрицательному балансу. Исключена ситуация, когда деньги с баланса не списываются, а перевод осуществляется. 8. Приложение содержит защиту от CSRF. Защита использует передачу токенов в запросе. 9. Написанный кандидатом код не подвержен уязвимости SQL-injection. Все запросы
используют биндинги вводимых значений. 10. Приложение не подвержено XSS. Все выводимые значения в браузере проходят экранирование html-символов. Желательно, используя средства выбранного фреймворка. 11. Приложение выводит список всех пользователей и информацию об одном последнем
переводе каждого пользователя с помощью одного SQL-запроса. Сам запрос не является странным или очень плохо оптимизированным. 12. Логика перевода вынесена либо в модель, либо в сервис. HTTP-контроллер и
консольный контроллер вызывает методы модели или сервиса. 13. Есть логи, либо иная возможность выяснить причину ошибки перевода после
неуспешного перевода.
